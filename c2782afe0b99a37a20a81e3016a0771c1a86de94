Revision: c2782afe0b99a37a20a81e3016a0771c1a86de94
Patch-set: 2
File: core/goma.mk

35
Tue Jul 19 06:30:59 2016 +0000
Author: Shinichiro Hamaji <1076769@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 4ac1b31c_298e8d25
Bytes: 601
Just a note - not an objection: Are you planning to use GOMA_HERMETIC=fallback on the bot? I'm not sure if error-for-developers-and-fallback-for-bot config is the best. Considering the motivation of bots is to find build failures before the build of end-developers fails, IMO fallback-for-developers-and-error-for-bots is the best option (fyi, this is how Chromium's build system is configured). However, I also understand setting GOMA_HERMETIC=error on bots would be troublesome before goma on bots becomes stable. Maybe setting GOMA_HERMETIC=fallback by default would be an option, but I'm not sure.

35
Tue Jul 19 16:01:32 2016 +0000
Author: David James <1076194@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 4ac1b31c_298e8d25
UUID: 6a6037e5_25ed6523
Bytes: 1177
I'd prefer to be able to use GOMA_HERMETIC=error everywhere, but doing this would require that GOMA can pick up toolchains from the build itself -- i.e. when we're testing a CL that modifies the toolchain, GOMA would pick up the new toolchain from the CL and use it. I believe GOMA can't do that with current architecture, so that's why we need fallback mode.

A question: When we update the toolchain in Android with a commit, does Goma pick it up immediately or is there some lag? If the latter, we actually want GOMA_HERMETIC=fallback everywhere, because it's then inevitable that there will be times when we can't compile on the goma farm.

The last option, GOMA_HERMETIC=off, is generally a recipe for trouble since it doesn't guarantee you get the right compiler. But, do we really know better than the user here? Maybe the user just wants to use the option for debugging goma performance?

I suggest we just delete all of this code for simplicity. GOMA can manage the options. Don't set GOMA_HERMETIC at all, and goma will default to "fallback" -- this is new as of 4 months ago: https://chrome-internal-review.googlesource.com/#/c/251515/

Thoughts from others on this?

35
Tue Jul 19 17:38:02 2016 +0000
Author: Fang Deng <1104568@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 6a6037e5_25ed6523
UUID: 6a6037e5_7620b504
Bytes: 148
Not setting GOMA_HERMETIC at all and defaulting to "fallback" make sense to me. Dan and Shinichiro, any other concern if we do what david suggested?

35
Tue Jul 19 20:26:48 2016 +0000
Author: Dan Willemsen <1074628@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 6a6037e5_7620b504
UUID: 6a6037e5_414e0695
Bytes: 38
Sure, always using fallback seems fine

